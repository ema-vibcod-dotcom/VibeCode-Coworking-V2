{% extends 'base.html' %}

{% block content %}

<div style="text-align: center; margin: 40px 0;">
    <h3>Estado Actual:
        <span class="{{ 'status-dentro' if status == 'dentro' else 'status-fuera' }}">
            {{ (status or 'DESCONOCIDO')|upper }}
        </span>
    </h3>

    {% if registro %}
    <div
        style="margin-top: 20px; padding: 20px; background: #f0f7ff; border: 1px solid #cce5ff; border-radius: 8px; display: inline-block; min-width: 350px; text-align: left;">
        <h4 style="margin-top: 0; color: #004085; border-bottom: 1px solid #b8daff; padding-bottom: 10px;">Detalles del
            Ingreso Actual</h4>
        <p style="margin: 10px 0;"><strong>Entrada:</strong> {{ registro.hora_ingreso.strftime('%H:%M:%S') if
            registro.hora_ingreso else '--:--:--' }}</p>

        <div
            style="margin-top: 15px; padding: 10px; background: white; border-radius: 4px; border: 1px dashed #b8daff;">
            <p style="margin: 0;"><strong>Reserva Vinculada:</strong></p>
            {% if registro.reserva %}
            <p style="margin: 5px 0; font-size: 1.1rem; color: #007bff;"><strong>{{ registro.reserva.espacio.nombre
                    }}</strong></p>
            <p style="margin: 0; font-size: 0.9rem; color: #555;">
                {{ registro.reserva.fecha.strftime('%d/%m/%Y') }} |
                {{ registro.reserva.hora_inicio.strftime('%H:%M') }} - {{ registro.reserva.hora_fin.strftime('%H:%M') }}
            </p>
            {% else %}
            <p style="margin: 5px 0; color: #666; font-style: italic;">Sin reserva asociada a este ingreso</p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if next_res and (not registro or not registro.reserva) %}
    <div
        style="margin-top: 20px; padding: 20px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px; display: inline-block; min-width: 350px; text-align: left;">
        <h4 style="margin-top: 0; color: #856404; border-bottom: 1px solid #ffeeba; padding-bottom: 10px;">Tu Pr√≥xima
            Reserva</h4>
        <p style="margin: 5px 0; font-size: 1.1rem; color: #856404;"><strong>{{ next_res.espacio.nombre }}</strong></p>
        <p style="margin: 0; font-size: 0.9rem; color: #555;">
            {{ next_res.fecha.strftime('%d/%m/%Y') }} |
            {{ next_res.hora_inicio.strftime('%H:%M') }} - {{ next_res.hora_fin.strftime('%H:%M') }}
        </p>
    </div>
    {% endif %}

    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
        <form action="{{ url_for('user.checkin') }}" method="POST" style="border: none; padding: 0; margin: 0;">
            <button type="submit" class="btn" style="background-color: #28a745;" {% if status=='dentro' %}disabled{%
                endif %}>
                Registrar Ingreso
            </button>
        </form>

        <form action="{{ url_for('user.checkout') }}" method="POST" style="border: none; padding: 0; margin: 0;">
            <button type="submit" class="btn" style="background-color: #dc3545;" {% if status=='fuera' %}disabled{%
                endif %}>
                Registrar Salida
            </button>
        </form>
    </div>
</div>
{% endblock %}